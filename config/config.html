<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin ‚Äî Configura√ß√£o do Evento</title>
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="/config/config.css" />

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body>
  <main>
    <div class="card" id="card">
      <h1>Admin ‚Äî Configura√ß√µes (Redis)</h1>
      <p class="sub">Edite os valores do banco e salve.</p>

      <div class="top-actions">
        <button id="btnReload" class="smallBtn">Recarregar do servidor</button>
        <button id="btnExport" class="smallBtn">Exportar JSON</button>
        <label class="smallBtn">
          Importar JSON
          <input id="fileImport" type="file" accept=".json,application/json" style="display:none" />
        </label>
        <div class="toggle-container">
          <label for="toggleMonitor" class="toggle-label">localiza√ß√£o:</label>
          <label class="toggle-switch">
            <input type="checkbox" id="toggleMonitor" checked>
            <span class="slider round"></span>
          </label>
        </div>
      </div>

      <form id="adminForm">
        <div class="grid">
          <div>
            <label class="required">RAIO PERMITIDO(METROS)
              <input id="allowedRadius" name="ALLOWED_RADIUS_METERS" type="number" required />
            </label>
          </div>

          <div>
            <label class="required">EVENTO
              <input id="evento" name="EVENTO" type="text" required />
            </label>
          </div>
          <div>
            <label class="required">FORMS
              <input id="forms" name="FORMS" type="text" required />
            </label>
          </div>

          <div>
            <label class="required">TARGET_LAT
              <input id="targetLat" name="TARGET_LAT" type="number" step="any" required />
            </label>
          </div>

          <div>
            <label class="required">TARGET_LNG
              <input id="targetLng" name="TARGET_LNG" type="number" step="any" required />
            </label>
          </div>
          <div class="full" style="text-align: center; margin-top: -0.5rem; margin-bottom: 0.5rem;">
            <button type="button" id="btnOpenMapPicker" class="smallBtn">üìç Selecionar no Mapa</button>
          </div>

          <div class="full">
            <label class="required">PALESTRAS</label>
            
            <div class="muted">Gerencie pares ID ‚Üí Nome. IDs devem ser √∫nicos (string ou number).</div>
            <button id="btnAtualizarTudo" type="button" class="atualizarBtn">ATUALIZAR TUDO</button>
            
            <div id="palestrasContainer" class="palestras-list"></div>

            <p style="margin-top:4rem;">Adicionar nova palestra</p>
            <div style="margin-top:0rem; display:flex; gap:.5rem;">
              <input id="newPalestraId" placeholder="ID da palestra (ex: 2304)" />
              <input id="newPalestraName" placeholder="Nome da palestra (ex: palestra ee)" />
              <button id="btnAddPalestra" type="button" class="smallBtn">Adicionar</button>
            </div>
          </div>

          <div class="full">
            <div style="display:flex; gap:.5rem; align-items:center; margin-top:2.5rem;">
              <button id="btnSave" class="buttonSubmit" type="button">Salvar no servidor</button>
              <button id="btnReset" type="button" class="smallBtn">Reset UI</button>
              <div id="statusMsg" class="situationMsg" ></div>
            </div>
          </div>

          <div class="full">
            <label>Preview do JSON</label>
            <pre id="jsonPreview" class="json-preview">Carregando...</pre>
          </div>
        </div>
      </form>

      <hr class="divider" />

      <div class="muted">Observa√ß√µes do backend:</div>
      <ul class="muted">
        <li>GET /api/config retorna o objeto JSON atual.</li>
        <li>PUT /api/config recebe o objeto JSON completo no corpo e persiste no Redis.</li>
      </ul>
    </div>
  </main>

  <div id="mapModalOverlay" class="map-modal-overlay">
    <div class="map-modal-content">
      <h3>Selecione a localiza√ß√£o</h3>
      <p class="sub">Clique no mapa para definir as coordenadas. O marcador ir√° mover.</p>
      <div id="mapContainer"></div>
      <div class="map-modal-actions">
        <button type="button" id="btnConfirmMapSelection" class="button">Confirmar</button>
        <button type="button" id="btnCloseMapModal" class="smallBtn">Cancelar</button>
      </div>
    </div>
  </div>

  <script src="/config/config.js"></script>

</body>
</html>
